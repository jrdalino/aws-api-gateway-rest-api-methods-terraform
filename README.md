# Terraform module to provision an AWS API Gateway Resource, Methods, Integration & Deployment for Users

## REST API Documentation

### Authentication
- Refer to this [documentation](https://github.com/NUS-ISS-ArchSS-Team10/bbsdm-user-aws-cognito-terraform) to retrieve the JWT Token

### Endpoints
| HTTP Verb | URI             | Description               |
| --------- | --------------- | ------------------------- |
| POST      | /prod/users     | Create a User             |
| GET       | /prod/users     | Get a list of Users       |
| GET       | /prod/users/:id | Get the details of a User |
| POST      | /prod/users/:id | Update an existing User   |
| DELETE    | /prod/users/:id | Delete an existing User   |

### Create a user
- Note: Use https://www.uuidgenerator.net/ to generate UUID for testing. In production, create user should only be called during User Registration and id will be generated by AWS Cognito.
- Request
```
$ curl -X POST \
https://0f5ttxbqjl.execute-api.ap-southeast-1.amazonaws.com/prod/users \
-H 'Authorization: eyJraWQiOi...' \
-H 'Cache-Control: no-cache' \
-H 'Content-Type: application/json' \
-d '{ 
  "email": "swatson@aol.com",   
  "id": "1ef2e500-7ce5-11eb-9439-0242ac130002", 
  "userType": "Trader"
}'
```
- Response Code

| HTTP response status code | Description  |
| ------------------------- | ------------ |
| 200                       | CREATED      |
| 400                       | Bad Request  |
| 401                       | Unauthorized |
| 403                       | Forbidden    |
| 404                       | Not found    |

- Response Body 
```
{
  "email": "swatson@aol.com",   
  "id": "6588e838-a122-11eb-8352-65d661ac4382",   
  "userType": "Trader"
}
```

### List users
- Request
```
$ curl -X GET \
https://0f5ttxbqjl.execute-api.ap-southeast-1.amazonaws.com/prod/users \
-H 'Authorization: eyJraWQiOi...' \
-H 'Cache-Control: no-cache' \
-H 'Content-Type: application/json'
```
- Response Code

| HTTP response status code | Description  |
| ------------------------- | ------------ |
| 200                       | OK           |
| 400                       | Bad Request  |
| 401                       | Unauthorized |
| 403                       | Forbidden    |
| 404                       | Not found    |

- Response Body
```
[
  {
    "email": "bwhittam0@cpanel.net", 
    "id": "dc64a495-7a47-11eb-9e32-6f24909f3f20", 
    "userType": "Trader"
  }, 
  {
    "email": "swatson@aol.com",     
    "id": "6588e838-a122-11eb-8352-65d661ac4382",
    "userType": "Trader"
  }
]
```

### Read a user
- Request
```
$ curl -X GET \
https://0f5ttxbqjl.execute-api.ap-southeast-1.amazonaws.com/prod/users/6588e838-a122-11eb-8352-65d661ac4382 \
-H 'Authorization: eyJraWQiOi...' \
-H 'Cache-Control: no-cache' \
-H 'Content-Type: application/json'
```
- Response Code

| HTTP response status code | Description  |
| ------------------------- | ------------ |
| 200                       | OK           |
| 400                       | Bad Request  |
| 401                       | Unauthorized |
| 403                       | Forbidden    |
| 404                       | Not found    |

- Response Body
```
{
  "email": "bwhittam0@cpanel.net", 
  "id": "6588e838-a122-11eb-8352-65d661ac4382", 
  "userType": "Trader"
}
```

### Update a user
```
$ curl -X PUT \
https://0f5ttxbqjl.execute-api.ap-southeast-1.amazonaws.com/prod/users/6588e838-a122-11eb-8352-65d661ac4382 \
-H 'Authorization: eyJraWQiOi...' \
-H 'Cache-Control: no-cache' \
-H 'Content-Type: application/json' \
-d '{ 
  "email": "swatson_v2@cpanel.net",   
  "id": "6588e838-a122-11eb-8352-65d661ac4382", 
  "userType": "Trader"
}'
```
- Response Code

| HTTP response status code | Description  |
| ------------------------- | ------------ |
| 200                       | OK           |
| 400                       | Bad Request  |
| 401                       | Unauthorized |
| 403                       | Forbidden    |
| 404                       | Not found    |

- Response Body
```
{
  "email": "bwhittam0V2@cpanel.net", 
  "id": "6588e838-a122-11eb-8352-65d661ac4382", 
  "userType": "Trader"
}
```

### Delete a user
- Request
```
$ curl -X DELETE \
https://0f5ttxbqjl.execute-api.ap-southeast-1.amazonaws.com/prod/users/6588e838-a122-11eb-8352-65d661ac4382 \
-H 'Authorization: eyJraWQiOi...' \
-H 'Cache-Control: no-cache' \
-H 'Content-Type: application/json'
```
- Response Code

| HTTP response status code | Description  |
| ------------------------- | ------------ |
| 204                       | OK           |
| 400                       | Bad Request  |
| 401                       | Unauthorized |
| 403                       | Forbidden    |
| 404                       | Not found    |

- Response Body: None

## Terraform Module Documentation

### Prerequisites
Provision an S3 bucket to store Terraform State and DynamoDB for state-lock
using https://github.com/NUS-ISS-ArchSS-Team10/aws-tfstate-backend-terraform

### Terraform Module Usage
- Replace variables in terraform.tfvars
- Replace variables in state_config.tf
- Initialize, Review Plan and Apply
```
$ terraform init
$ terraform fmt
$ terraform validate
$ terraform plan
$ terraform apply
```

### Inputs
| Name | Description |
|------|-------------|
| | |

### Outputs
| Name | Description |
|------|-------------|
| | |